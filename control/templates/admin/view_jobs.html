{% extends "base.html" %}

{% block body %}
<div class="main">
    <h1><a href="{{ url_for('home.home') }}" class="action">Control Panel</a> &rarr; <a href="{{ url_for('admin.home') }}" class="action">Administration</a> &rarr; {{ state|title }}</h1>
    {%- if max_pages > 1 %}
    <p>Page: {% for i in range(1, max_pages + 1) %}{% if i == page %}<strong>{{ i }}</strong>{% else %}<a href="?page={{ i }}">{{ i }}</a>{% endif %}{% if not loop.last %} {% endif %}{% endfor %}</p>
    {%- endif %}
    {%- if jobs %}
    <table>
        <thead>
            <tr>
                <th>ID</th>
                <th>Owner</th>
                <th>Type</th>
                <th>Message</th>
                {%- if state in ["unapproved", "queued", "running"] %}
                <th>Actions</th>
                {%- endif %}
            </tr>
        </thead>
        <tbody>
            {%- for job in jobs %}
            <tr>
                <td><a href="{{ url_for('admin.status', id=job.job_id) }}">{{ job.job_id }}</a></td>
                <td>{{ job.owner_crsid }}</td>
                <td>{{ job }}</td>
                <td>{{ job.state_message or ("&mdash;"|safe) }}</td>
                {%- if state == "unapproved" %}
                <td><a href="{{ url_for('admin.set_state', id=job.job_id, state=state, approved=True) }}">Approve</a> &bullet; <a href="{{ url_for('admin.set_state', id=job.job_id, state=state, approved=False) }}">Reject</a></td>
                {%- elif state == "queued" %}
                <td><a href="{{ url_for('admin.set_state', id=job.job_id, state=state) }}">Cancel</a></td>
                {%- elif state == "running" %}
                <td><a href="{{ url_for('admin.set_state', id=job.job_id, state=state) }}" onclick="return confirm('Warning: this won\'t stop a running job, only set its status to failed!');">Move to failed</a></td>
                {%- endif %}
            </tr>
            {%- endfor %}
        </tbody>
    </table>
    {%- else %}
    <p>No jobs to show.</p>
    {%- endif %}
</div>
{% endblock body %}
